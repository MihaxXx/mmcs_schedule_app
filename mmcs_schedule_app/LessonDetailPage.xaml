<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:mmcs_schedule_app"
             x:Class="mmcs_schedule_app.LessonDetailPage"
             x:DataType="local:LessonDetailPage"
             BackgroundColor="Transparent">
    <Grid>
        <!-- Transparent background -->
        <BoxView BackgroundColor="Transparent">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="ClosePopup" />
            </BoxView.GestureRecognizers>
        </BoxView>
        <!-- Popup content -->
        <Border VerticalOptions="End"
                Margin="0"
                Padding="0"
                Stroke="{AppThemeBinding Light=LightGray, Dark=Gray}"
                BackgroundColor="{AppThemeBinding Light=#FFFFFFFF, Dark=#FF1E1E1E}">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="20,20,0,0" />
            </Border.StrokeShape>
            <Border.GestureRecognizers>
                <SwipeGestureRecognizer Direction="Down"
                                        Swiped="ClosePopup" />
            </Border.GestureRecognizers>
            <VerticalStackLayout>
                <!-- Handle bar -->
                <BoxView HeightRequest="5"
                         WidthRequest="40"
                         Color="Gray"
                         HorizontalOptions="Center"
                         Margin="0,10" />
                <ScrollView MaximumHeightRequest="600">
                    <VerticalStackLayout Padding="20,0,20,20"
                                         Spacing="10">
                        <Label HorizontalTextAlignment="Center"
                               LineBreakMode="WordWrap">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding DisciplineName}"
                                          FontSize="20"
                                          FontAttributes="Bold" />
                                    <Span Text="{Binding Weekday}"
                                          FontSize="16" />
                                    <Span Text="{Binding Timeslot}"
                                          FontSize="16" />
                                    <Span Text="{Binding WeekType}"
                                          FontSize="16"
                                          FontAttributes="Italic" />
                                    <Span Text="{Binding RoomInfo}"
                                          FontSize="16" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                        <!-- Teachers/Groups list -->
                        <CollectionView ItemsSource="{Binding Items}"
                                        SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="local:LessonItemInfo">
                                    <HorizontalStackLayout Spacing="10"
                                                           Padding="5">
                                        <HorizontalStackLayout.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type local:LessonDetailPage}}, Path=ItemTappedCommand}"
                                                                  CommandParameter="{Binding .}" />
                                        </HorizontalStackLayout.GestureRecognizers>
                                        <Label Text="â€¢"
                                               FontSize="16"
                                               VerticalOptions="Start" />
                                        <VerticalStackLayout Spacing="7">
                                            <Label Text="{Binding MainText}"
                                                   FontSize="16" />
                                            <Label Text="{Binding SubText}"
                                                   FontSize="14"
                                                   TextColor="Gray"
                                                   IsVisible="{Binding HasSubText}" />
                                        </VerticalStackLayout>
                                    </HorizontalStackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </ScrollView>
            </VerticalStackLayout>
        </Border>
    </Grid>
</ContentPage>
